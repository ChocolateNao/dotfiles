#!/usr/bin/env bash

source {{ joinPath .chezmoi.sourceDir "/helpers/logger.sh" | quote }}

PACKAGE_MANAGER="{{- template "pkg_manager" . -}}"

run_playbook() {
    log_info "Running ansible playbook"
    if command -v ansible-playbook &> /dev/null; then
        ansible-playbook -i {{ joinPath .chezmoi.sourceDir "dot_bootstrap/inventory.ini" | quote }} {{ joinPath .chezmoi.sourceDir "dot_bootstrap/playbook.yml" | quote }} --ask-become-pass
    fi
}

if [ $PACKAGE_MANAGER = "unknown" ]; then
    log_error "Current system's package manager is unsupported. Unable to install packages via ansible. Skipping..."
else
    run_playbook
fi

